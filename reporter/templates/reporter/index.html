{% extends 'base.html' %}
{% load static %}
{% block content %}

<div>
    <h2>A Boon For Cr's, (seriously, it's just a Reddit-Clone)</h2>
    {% if request.user.is_authenticated %}
    <h4>Department: {{request.user.info.department|upper}} {{request.user.info.join_year}}</h4>
    <h3>Welcome, {{request.user.first_name}} {{request.user.last_name}}</h3>
    <div class="container">
        <a class="mr-3" href="{% url 'reporter:issue-form' %}">Add New Issue</a>
        <a class="mx-2" href="{% url 'reporter:resolved' %}">Resolved</a>
        {% if request.user.info.is_cr %}
        <a href="{% url 'reporter:close-stage' %}">Closed</a>
        <a class="ml-2 btn btn-secondary btn-sm" href="{% url 'reporter:voted-list' %}">Voting Data</a>
        <a class="ml-5 btn btn-primary btn-sm" href="{% url 'reporter:info-pending' %}">Pending List</a>
        {% endif %}
        <a class="ml-2 btn btn-primary btn-sm" href="{% url 'reporter:info-list' %}">Information List</a>
    </div>
    <hr>

    {% for issue in issue_list %}
    <div class="card border-primary mb-3" style="max-width: 45rem;">
        <div class="card-header">{{issue.user.user.first_name}} ({{issue.user.user.username}}) {% if issue.user.is_cr %}<strong>(CR)</strong>{% endif %}{% if request.user == issue.user.user %} <a href="{% url 'reporter:edit' issue.id %}">Edit +</a>{% endif %} {% if request.user.info.is_cr or request.user == issue.user.user %}<button type="button" class="btn btn-danger" data-toggle="modal" data-target="#deleteModal">X</button>{% endif %}{% if request.user.info.is_cr %} <a class="btn btn-success ml-2" href="{% url 'reporter:close-issue' issue.id %}">Close</a> {% endif %}</div>
        <div class="card-body text-primary">
            <h5 class="card-title">{{issue.title}}</h5>
            <p class="card-text" >{{issue.content}}</p>
          <p class="card-text">Posted on: {{issue.timestamp}}</p>
        </div>
        <div class="vote" data-id="{{issue.id}}">
            <button data-id="{{issue.id}}" class="upvote btn btn-link">Upvote</button>
            <button data-id="{{issue.id}}" class="downvote btn btn-link">Downvote</button>
            <button data-id="{{issue.id}}" class="upvoted btn btn-link">Upvoted</button>
            <button data-id="{{issue.id}}" class="downvoted btn btn-link">Downvoted</button>
            <!-- {% if request.user.info.is_cr %}
                <span>UpVotes: {{issue.upvotes}}</span>
                <span>DownVotes: {{issue.downvotes}}</span>
            {% endif %} -->
        </div>
        {% if issue.deadline %}
            <p class="deadline-date ml-2"><em>Deadline: </em>{{issue.deadline}}</p>
            {% if request.user.info.is_cr %}
            <p class="ml-3"><a class="btn btn-danger btn-sm" href="{% url 'reporter:remove-deadline' issue.id %}">Remove Deadline</a></p>
            {% endif %}
        {% else %}
            {% if request.user.info.is_cr %}
                <div class=" ml-2 mt-2 pb-3 deadline">
                    <form action="{% url 'reporter:add-deadline' %}" method="post">
                        {% csrf_token %}
                        {{form}}
                        <input type="hidden" name="id" value="{{issue.id}}">
                        <input class="ml-2 btn btn-primary btn-sm" type="submit" value="Add Deadline">
                    </form>
                </div>
            {% endif %}
        {% endif %}
    </div>
    {% include 'reporter/modal_.html' with id=issue.id %}
    {% empty %}
    <p class="lead">Woohoo, No Active Issues!</p>
    {% endfor %}
    {% else %}
    <p class="">Log In to Report Issues!</p>
    {% endif %}
</div>
{% endblock %}